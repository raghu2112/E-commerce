<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THREADLINE â€” Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --orange:#FF6B00; --dark:#0A0A0A; --dark2:#0d0d0d; --card:#111;
    --text:#F0EDE8; --muted:#666; --border:rgba(255,255,255,0.07);
    --green:#22c55e; --red:#ef4444; --blue:#3b82f6; --yellow:#eab308; --purple:#a855f7;
  }
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
  body{font-family:'DM Sans',sans-serif;background:var(--dark);color:var(--text);min-height:100vh;display:flex;}

  /* SIDEBAR */
  .sidebar{width:240px;min-height:100vh;background:var(--dark2);border-right:1px solid var(--border);display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:100;padding:32px 0;}
  .sidebar-logo{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:.1em;padding:0 28px 32px;border-bottom:1px solid var(--border);}
  .sidebar-logo span{color:var(--orange);}
  .sidebar-nav{padding:24px 16px;flex:1;display:flex;flex-direction:column;gap:4px;}
  .nav-item{display:flex;align-items:center;gap:12px;padding:12px 14px;text-decoration:none;color:var(--muted);font-size:.82rem;font-weight:500;letter-spacing:.04em;border-radius:3px;transition:all .2s;}
  .nav-item:hover{background:rgba(255,107,0,.08);color:var(--text);}
  .nav-item.active{background:rgba(255,107,0,.12);color:var(--orange);}
  .sidebar-bottom{padding:16px 16px 0;border-top:1px solid var(--border);}
  .logout-btn{display:flex;align-items:center;gap:10px;padding:12px 14px;text-decoration:none;color:var(--muted);font-size:.82rem;font-weight:500;border-radius:3px;transition:all .2s;}
  .logout-btn:hover{color:var(--red);background:rgba(239,68,68,.08);}

  /* MAIN */
  .main{margin-left:240px;flex:1;padding:40px;min-height:100vh;}
  .page-eyebrow{font-size:.65rem;letter-spacing:.28em;text-transform:uppercase;color:var(--orange);font-weight:700;margin-bottom:8px;}
  .page-title{font-family:'Bebas Neue',sans-serif;font-size:3rem;letter-spacing:.04em;margin-bottom:36px;}

  /* STATS */
  .stats{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px;margin-bottom:40px;}
  .stat-card{background:var(--card);border:1px solid var(--border);border-radius:4px;padding:20px 18px;transition:border-color .25s;}
  .stat-card:hover{border-color:rgba(255,107,0,.25);}
  .stat-label{font-size:.6rem;letter-spacing:.2em;text-transform:uppercase;color:var(--muted);font-weight:700;margin-bottom:10px;}
  .stat-value{font-family:'Bebas Neue',sans-serif;font-size:2.1rem;letter-spacing:.04em;line-height:1;}
  .stat-value.orange{color:var(--orange);}
  .stat-value.green{color:var(--green);}
  .stat-value.red{color:var(--red);}
  .stat-value.yellow{color:var(--yellow);}
  .stat-sub{font-size:.72rem;color:var(--muted);margin-top:5px;}

  /* SECTION */
  .section{background:var(--card);border:1px solid var(--border);border-radius:4px;margin-bottom:28px;overflow:hidden;}
  .section-head{display:flex;align-items:center;justify-content:space-between;padding:20px 26px;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:10px;}
  .section-name{font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:.06em;}
  .section-head-right{display:flex;align-items:center;gap:10px;}

  /* BADGES */
  .badge{display:inline-block;padding:4px 12px;border-radius:2px;font-size:.63rem;font-weight:700;letter-spacing:.15em;text-transform:uppercase;}
  .badge-orange{background:rgba(255,107,0,.12);color:var(--orange);}
  .badge-green{background:rgba(34,197,94,.1);color:var(--green);}
  .badge-red{background:rgba(239,68,68,.1);color:var(--red);}
  .badge-muted{background:rgba(255,255,255,.06);color:var(--muted);}
  .badge-yellow{background:rgba(234,179,8,.1);color:var(--yellow);}
  .badge-blue{background:rgba(59,130,246,.1);color:var(--blue);}
  .badge-purple{background:rgba(168,85,247,.1);color:var(--purple);}

  /* SETTINGS FORMS */
  .settings-form{padding:26px;display:flex;gap:14px;align-items:flex-end;flex-wrap:wrap;}
  .settings-field{flex:1;min-width:160px;}
  .settings-field label{display:block;font-size:.68rem;letter-spacing:.16em;text-transform:uppercase;color:var(--muted);font-weight:700;margin-bottom:8px;}
  .settings-field input{width:100%;background:#1a1a1a;border:1px solid var(--border);color:var(--text);padding:12px 16px;font-family:'DM Sans',sans-serif;font-size:.9rem;border-radius:3px;outline:none;transition:all .25s;}
  .settings-field input:focus{border-color:var(--orange);box-shadow:0 0 0 3px rgba(255,107,0,.1);}
  .settings-field input::placeholder{color:var(--muted);}
  .settings-field .field-note{font-size:.68rem;color:var(--muted);margin-top:6px;}

  /* BUTTONS */
  .btn{display:inline-flex;align-items:center;gap:6px;padding:10px 18px;font-family:'DM Sans',sans-serif;font-size:.75rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;border-radius:3px;cursor:pointer;text-decoration:none;border:none;transition:all .25s;white-space:nowrap;}
  .btn-orange{background:var(--orange);color:#000;}
  .btn-orange:hover{background:#ff7d1a;transform:translateY(-1px);}
  .btn-green{background:rgba(34,197,94,.1);color:var(--green);border:1px solid rgba(34,197,94,.25);}
  .btn-green:hover{background:rgba(34,197,94,.2);}
  .btn-red{background:rgba(239,68,68,.1);color:var(--red);border:1px solid rgba(239,68,68,.25);}
  .btn-red:hover{background:rgba(239,68,68,.2);}
  .btn-ghost{background:transparent;color:var(--muted);border:1px solid var(--border);}
  .btn-ghost:hover{border-color:var(--orange);color:var(--orange);}
  .btn-export{background:rgba(59,130,246,.1);color:var(--blue);border:1px solid rgba(59,130,246,.25);}
  .btn-export:hover{background:rgba(59,130,246,.2);}

  /* TABLE */
  .table-wrap{overflow-x:auto;}
  table{width:100%;border-collapse:collapse;font-size:.83rem;}
  thead th{padding:12px 14px;text-align:left;font-size:.6rem;letter-spacing:.2em;text-transform:uppercase;color:var(--muted);font-weight:700;background:#0d0d0d;border-bottom:1px solid var(--border);white-space:nowrap;}
  tbody tr{border-bottom:1px solid var(--border);transition:background .15s;}
  tbody tr:last-child{border-bottom:none;}
  tbody tr:hover{background:rgba(255,255,255,.02);}
  tbody td{padding:12px 14px;color:var(--text);vertical-align:middle;}
  .td-id{font-family:monospace;font-size:.78rem;color:var(--muted);}
  .td-sm{font-size:.78rem;color:var(--muted);}
  .td-date{font-size:.72rem;color:var(--muted);}
  .empty-row td{text-align:center;padding:40px;color:var(--muted);font-size:.85rem;}
  .empty-row span{display:block;font-size:1.8rem;margin-bottom:10px;}
  .design-img,.payment-thumb{width:46px;height:46px;object-fit:cover;border-radius:3px;border:1px solid var(--border);}
  .payment-thumb{cursor:pointer;transition:transform .2s;}
  .payment-thumb:hover{transform:scale(1.12);}
  .stock-in{color:var(--green);font-weight:600;font-size:.8rem;}
  .stock-out{color:var(--red);font-weight:600;font-size:.8rem;}
  .action-link{color:var(--orange);text-decoration:none;font-size:.75rem;font-weight:600;letter-spacing:.08em;transition:opacity .2s;}
  .action-link:hover{opacity:.7;}
  .action-link.danger{color:var(--red);}

  /* STATUS DROPDOWN */
  .status-form{display:inline-block;}
  .status-select{
    appearance:none;-webkit-appearance:none;
    padding:5px 28px 5px 10px;
    font-family:'DM Sans',sans-serif;font-size:.63rem;font-weight:700;
    letter-spacing:.12em;text-transform:uppercase;border-radius:2px;
    border:none;outline:none;cursor:pointer;transition:all .2s;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='currentColor' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat:no-repeat;background-position:right 8px center;
  }
  .status-select.s-pending   {background-color:rgba(255,107,0,.12);  color:var(--orange);}
  .status-select.s-verifying {background-color:rgba(234,179,8,.12);  color:var(--yellow);}
  .status-select.s-processing{background-color:rgba(59,130,246,.12); color:var(--blue);}
  .status-select.s-shipped   {background-color:rgba(168,85,247,.12); color:var(--purple);}
  .status-select.s-completed {background-color:rgba(34,197,94,.1);   color:var(--green);}
  .status-select.s-cancelled {background-color:rgba(239,68,68,.1);   color:var(--red);}
  .status-select option{background:#1a1a1a;color:var(--text);}

  /* Email config info note */
  .info-note{background:rgba(59,130,246,.05);border:1px solid rgba(59,130,246,.15);border-radius:3px;padding:12px 16px;font-size:.78rem;color:var(--muted);line-height:1.55;margin:0 26px 20px;}
  .info-note strong{color:var(--blue);}
  .info-note a{color:var(--blue);}
  .pw-wrap{position:relative;}
  .pw-wrap input{padding-right:44px!important;}
  .pw-eye{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--muted);cursor:pointer;padding:4px;}
  .pw-eye:hover{color:var(--text);}
</style>
</head>
<body>

<!-- â”€â”€ SIDEBAR â”€â”€ -->
<aside class="sidebar">
  <div class="sidebar-logo">THREAD<span>LINE</span></div>
  <nav class="sidebar-nav">
    <a class="nav-item active" href="/dashboard">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="1" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.4"/><rect x="9" y="1" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.4"/><rect x="1" y="9" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.4"/><rect x="9" y="9" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.4"/></svg>
      Dashboard
    </a>
    <a class="nav-item" href="/add_design">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.4"/><path d="M8 5v6M5 8h6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
      Add Design
    </a>
    <a class="nav-item" href="/export_orders">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M3 3h10v2H3zM3 7h10M3 11h6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><path d="M11 10l2 2-2 2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Export Orders
    </a>
    <a class="nav-item" href="/sales_analysis">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M2 13L5 9l3 2 3-5 3 2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Sales Chart
    </a>
    <a class="nav-item" href="/change_password">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="2" y="7" width="12" height="8" rx="1.5" stroke="currentColor" stroke-width="1.4"/><path d="M5 7V5a3 3 0 016 0v2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><circle cx="8" cy="11" r="1.2" fill="currentColor"/></svg>
      Change Password
    </a>
  </nav>
  <div class="sidebar-bottom">
    <a class="logout-btn" href="/logout">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M6 14H3a1 1 0 01-1-1V3a1 1 0 011-1h3M11 11l3-3-3-3M14 8H6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Logout
    </a>
  </div>
</aside>

<!-- â”€â”€ MAIN â”€â”€ -->
<main class="main">
  <p class="page-eyebrow">Admin Panel</p>
  <h1 class="page-title">Dashboard</h1>

  <!-- STATS -->
  <div class="stats">
    <div class="stat-card">
      <p class="stat-label">Active Orders</p>
      <div class="stat-value orange">{{ active_orders|length }}</div>
      <p class="stat-sub">In progress</p>
    </div>
    <div class="stat-card">
      <p class="stat-label">Completed</p>
      <div class="stat-value green">{{ completed_orders|length }}</div>
      <p class="stat-sub">All time</p>
    </div>
    <div class="stat-card">
      <p class="stat-label">Cancelled</p>
      <div class="stat-value red">{{ cancelled_orders|length }}</div>
      <p class="stat-sub">All time</p>
    </div>
    <div class="stat-card">
      <p class="stat-label">Total Revenue</p>
      <div class="stat-value green">â‚¹{{ total_revenue }}</div>
      <p class="stat-sub">Completed orders</p>
    </div>
    <div class="stat-card">
      <p class="stat-label">This Month</p>
      <div class="stat-value orange">â‚¹{{ monthly_revenue }}</div>
      <p class="stat-sub">Revenue</p>
    </div>
    <div class="stat-card">
      <p class="stat-label">Designs</p>
      <div class="stat-value yellow">{{ designs|length }}</div>
      <p class="stat-sub">In catalog</p>
    </div>
    <div class="stat-card">
      <p class="stat-label">Best Seller</p>
      <div class="stat-value" style="font-size:1rem;padding-top:4px;line-height:1.3">{{ best_design }}</div>
      <p class="stat-sub">By order count</p>
    </div>
  </div>


  <!-- â”€â”€ PHONEPE SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="section">
    <div class="section-head"><span class="section-name">PhonePe / Payment Settings</span></div>
    <form class="settings-form" method="POST" action="/update_phonepe">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <div class="settings-field">
        <label>Account Name</label>
        <input name="name" value="{{ settings.phonepe_name }}" placeholder="Name on PhonePe">
      </div>
      <div class="settings-field">
        <label>PhonePe Number</label>
        <input name="number" value="{{ settings.phonepe_number }}" placeholder="10-digit number">
      </div>
      <div class="settings-field">
        <label>WhatsApp Number <span style="font-size:.6rem;color:var(--muted);text-transform:none;letter-spacing:0">(with country code, no +)</span></label>
        <input name="whatsapp" value="{{ settings.admin_whatsapp }}" placeholder="e.g. 919876543210">
      </div>
      <button class="btn btn-orange" type="submit">Update</button>
    </form>
  </div>


  <!-- â”€â”€ EMAIL CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="section">
    <div class="section-head">
      <span class="section-name">Email Configuration</span>
      <span class="badge {% if settings.resend_api_key and settings.resend_from %}badge-green{% else %}badge-muted{% endif %}">
        {% if settings.resend_api_key and settings.resend_from %}âœ“ Configured{% else %}Not set{% endif %}
      </span>
    </div>

    <p class="info-note">
      Emails are sent via <strong>Resend</strong> â€” free, 3,000 emails/month, no SMTP needed.<br>
      <strong>One-time setup:</strong>
      &nbsp;â‘  <a href="https://resend.com" target="_blank">Sign up at resend.com</a>
      &nbsp;â‘¡ Go to <strong>API Keys</strong> â†’ Create Key â†’ paste below
      &nbsp;â‘¢ Go to <strong>Domains</strong> â†’ Add your domain and verify it
      (or use <code>onboarding@resend.dev</code> as From address just for testing â€” only sends to your own Resend-registered email)
    </p>

    <form class="settings-form" method="POST" action="/update_email_config">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

      <div class="settings-field">
        <label>Resend API Key</label>
        <div class="pw-wrap">
          <input type="password" id="resendKey" name="resend_api_key"
                 placeholder="{% if settings.resend_api_key %}â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢{% else %}re_xxxxxxxxxxxxxxxxxxxx{% endif %}"
                 autocomplete="new-password">
          <button type="button" class="pw-eye" onclick="togglePwd('resendKey')">
            <svg width="16" height="16" viewBox="0 0 18 18" fill="none"><path d="M1 9s3-6 8-6 8 6 8 6-3 6-8 6-8-6-8-6z" stroke="currentColor" stroke-width="1.3"/><circle cx="9" cy="9" r="2.5" stroke="currentColor" stroke-width="1.3"/></svg>
          </button>
        </div>
        <p class="field-note">Leave blank to keep your existing key. Get it from <a href="https://resend.com/api-keys" target="_blank">resend.com/api-keys</a>.</p>
      </div>

      <div class="settings-field">
        <label>From Address <span style="font-size:.6rem;color:var(--muted);text-transform:none;letter-spacing:0">(what customers see as the sender)</span></label>
        <input type="text" name="resend_from" value="{{ settings.resend_from }}"
               placeholder="THREADLINE &lt;orders@yourdomain.com&gt;">
        <p class="field-note">Format: <code>Display Name &lt;email@yourdomain.com&gt;</code> â€” the domain must be verified in Resend. For testing use <code>onboarding@resend.dev</code>.</p>
      </div>

      <div class="settings-field">
        <label>Your Alert Email <span style="font-size:.6rem;color:var(--muted);text-transform:none;letter-spacing:0">(you receive a notification for every new order)</span></label>
        <input type="email" name="admin_email" value="{{ settings.admin_email }}"
               placeholder="your@gmail.com">
        <p class="field-note">This is YOUR email â€” can be any address you check regularly.</p>
      </div>

      <div style="display:flex;gap:12px;flex-wrap:wrap;">
        <button class="btn btn-orange" type="submit">Save Email Config</button>
        {% if settings.resend_api_key and settings.resend_from and settings.admin_email %}
        <form method="POST" action="/send_test_email" style="margin:0">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button class="btn btn-ghost" type="submit"
                  onclick="return confirm('Send a test email to {{ settings.admin_email }}?')">
            Send Test Email â†’
          </button>
        </form>
        {% endif %}
      </div>
    </form>
  </div>


  <!-- â”€â”€ ACTIVE ORDERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="section">
    <div class="section-head">
      <span class="section-name">Active Orders</span>
      <div class="section-head-right">
        <span class="badge badge-orange">{{ active_orders|length }} Active</span>
        <a class="btn btn-export" href="/export_orders">Export Excel</a>
      </div>
    </div>
    <div class="table-wrap">
      <table>
        <thead><tr>
          <th>ID</th><th>Design</th><th>Customer</th><th>Address</th>
          <th>Phone</th><th>Email</th><th>Size</th><th>Qty</th>
          <th>Payment</th><th>Invoice</th><th>Placed At</th><th>Status</th>
        </tr></thead>
        <tbody>
          {% for o in active_orders %}
          <tr>
            <td class="td-id">#{{ o.id }}</td>
            <td><b>{{ o.design }}</b><br><span class="td-sm">{{ o.design_code }}</span></td>
            <td>{{ o.customer_name }}</td>
            <td class="td-sm">{{ o.house }}, {{ o.city }},<br>{{ o.mandal }}{% if o.pincode %} â€” {{ o.pincode }}{% endif %}</td>
            <td>{{ o.phone }}</td>
            <td class="td-sm">{{ o.email }}</td>
            <td><span class="badge badge-muted">{{ o.size }}</span></td>
            <td>{{ o.quantity }}</td>
            <td>
              <a href="{{ o.payment_image }}" target="_blank">
                <img class="payment-thumb" src="{{ o.payment_image }}">
              </a>
            </td>
            <td><a class="action-link" href="/invoice/{{ o.id }}" target="_blank">PDF</a></td>
            <td class="td-date">{{ o.created_at }}</td>
            <td>
              <!-- Status dropdown â€” auto-submits on change -->
              <form class="status-form" method="POST" action="/update_status/{{ o.id }}" id="sf-{{ o.id }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <select class="status-select s-{{ o.status|lower }}"
                        name="status"
                        onchange="confirmStatus(this, {{ o.id }}, '{{ o.status }}')"
                        title="Change order status">
                  {% for stage in order_stages %}
                  <option value="{{ stage }}" {% if o.status == stage %}selected{% endif %}>{{ stage }}</option>
                  {% endfor %}
                  <option value="Cancelled" {% if o.status == 'Cancelled' %}selected{% endif %}>Cancelled</option>
                </select>
              </form>
            </td>
          </tr>
          {% else %}
          <tr class="empty-row"><td colspan="12"><span>ðŸŽ‰</span>No active orders right now!</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>


  <!-- â”€â”€ COMPLETED ORDERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="section">
    <div class="section-head">
      <span class="section-name">Completed Orders</span>
      <span class="badge badge-green">{{ completed_orders|length }}</span>
    </div>
    <div class="table-wrap">
      <table>
        <thead><tr>
          <th>ID</th><th>Design</th><th>Customer</th><th>Phone</th>
          <th>Size</th><th>Qty</th><th>Completed At</th><th>Status</th>
        </tr></thead>
        <tbody>
          {% for o in completed_orders %}
          <tr>
            <td class="td-id">#{{ o.id }}</td>
            <td>{{ o.design }}</td>
            <td>{{ o.customer_name }}</td>
            <td>{{ o.phone }}</td>
            <td><span class="badge badge-muted">{{ o.size }}</span></td>
            <td>{{ o.quantity }}</td>
            <td class="td-date">{{ o.completed_at }}</td>
            <td><span class="badge badge-green">Completed</span></td>
          </tr>
          {% else %}
          <tr class="empty-row"><td colspan="8"><span>ðŸ“¦</span>No completed orders yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>


  <!-- â”€â”€ CANCELLED ORDERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="section">
    <div class="section-head">
      <span class="section-name">Cancelled Orders</span>
      <span class="badge badge-red">{{ cancelled_orders|length }}</span>
    </div>
    <div class="table-wrap">
      <table>
        <thead><tr>
          <th>ID</th><th>Design</th><th>Customer</th><th>Phone</th>
          <th>Size</th><th>Qty</th><th>Cancelled At</th><th>Status</th>
        </tr></thead>
        <tbody>
          {% for o in cancelled_orders %}
          <tr>
            <td class="td-id">#{{ o.id }}</td>
            <td>{{ o.design }}</td>
            <td>{{ o.customer_name }}</td>
            <td>{{ o.phone }}</td>
            <td><span class="badge badge-muted">{{ o.size }}</span></td>
            <td>{{ o.quantity }}</td>
            <td class="td-date">{{ o.cancelled_at }}</td>
            <td><span class="badge badge-red">Cancelled</span></td>
          </tr>
          {% else %}
          <tr class="empty-row"><td colspan="8"><span>âœ…</span>No cancelled orders.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>


  <!-- â”€â”€ DESIGNS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="section">
    <div class="section-head">
      <span class="section-name">Catalog</span>
      <div class="section-head-right">
        <span class="badge badge-muted">{{ designs|length }} designs</span>
        <a class="btn btn-orange" href="/add_design">+ Add Design</a>
      </div>
    </div>
    <div class="table-wrap">
      <table>
        <thead><tr>
          <th>Image</th><th>Code</th><th>Name</th><th>Price</th>
          <th>Photos</th><th>Stock Qty</th><th>Status</th><th>Actions</th>
        </tr></thead>
        <tbody>
          {% for d in designs %}
          <tr>
            <td><img class="design-img" src="{{ d.image }}" alt="{{ d.name }}"></td>
            <td class="td-sm">{{ d.design_code }}</td>
            <td><b>{{ d.name }}</b><br><span class="td-sm">{{ d.description[:40] }}{% if d.description|length > 40 %}â€¦{% endif %}</span></td>
            <td><b style="color:var(--orange)">â‚¹{{ d.price }}</b></td>
            <td class="td-sm">{{ d.images|length }} photo{% if d.images|length != 1 %}s{% endif %}</td>
            <td>{{ d.stock_quantity }}</td>
            <td>
              <span class="{% if d.stock == 'In Stock' %}stock-in{% else %}stock-out{% endif %}">
                {{ d.stock }}
              </span>
            </td>
            <td style="display:flex;gap:6px;flex-wrap:wrap;align-items:center;">
              <a class="btn btn-ghost" href="/edit_design/{{ d.id }}">Edit</a>
              <a class="btn btn-ghost" href="/toggle_stock/{{ d.id }}">
                {% if d.stock == 'In Stock' %}Disable{% else %}Enable{% endif %}
              </a>
              <a class="btn btn-red action-link danger" href="/delete_design/{{ d.id }}"
                 onclick="return confirm('Delete {{ d.name }}? This cannot be undone.')">Delete</a>
            </td>
          </tr>
          {% else %}
          <tr class="empty-row"><td colspan="8"><span>ðŸŽ¨</span>No designs yet. <a href="/add_design" style="color:var(--orange)">Add your first design â†’</a></td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</main>

<script>
// â”€â”€ Status dropdown confirmation & colour update â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function confirmStatus(select, orderId, currentStatus) {
  const newStatus = select.value;
  if (newStatus === currentStatus) return;

  const confirmMsg = newStatus === 'Cancelled'
    ? `Cancel order #${orderId}? Stock will be restored and customer will be notified.`
    : `Change order #${orderId} status to "${newStatus}"? Customer will receive an email.`;

  if (!confirm(confirmMsg)) {
    // Revert select to original value
    select.value = currentStatus;
    return;
  }

  // Update colour class immediately for visual feedback
  select.className = 'status-select s-' + newStatus.toLowerCase();

  // Submit the form
  document.getElementById('sf-' + orderId).submit();
}

// â”€â”€ Gmail App Password show/hide â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function togglePwd(id) {
  const input = document.getElementById(id);
  input.type = input.type === 'password' ? 'text' : 'password';
}
</script>
</body>
</html>
