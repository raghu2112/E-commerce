<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THREADLINE — Add Design</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root{--orange:#FF6B00;--dark:#0A0A0A;--card:#111;--text:#F0EDE8;--muted:#666;--border:rgba(255,255,255,0.08);--input-bg:#1a1a1a;--red:#ef4444;}
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
  body{font-family:'DM Sans',sans-serif;background:var(--dark);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:40px 20px;}
  .bg{position:fixed;inset:0;background:radial-gradient(ellipse 50% 50% at 70% 30%,rgba(255,107,0,0.07),transparent);pointer-events:none;}
  .card{position:relative;z-index:2;background:var(--card);border:1px solid var(--border);border-radius:4px;padding:52px 48px;width:100%;max-width:600px;box-shadow:0 40px 80px rgba(0,0,0,.5);animation:slideUp .7s cubic-bezier(.16,1,.3,1) forwards;}
  @keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
  .back-link{display:inline-flex;align-items:center;gap:8px;color:var(--muted);font-size:.72rem;letter-spacing:.15em;text-transform:uppercase;text-decoration:none;margin-bottom:36px;transition:color .2s;}
  .back-link:hover{color:var(--orange);}
  .eyebrow{font-size:.65rem;letter-spacing:.28em;text-transform:uppercase;color:var(--orange);font-weight:700;margin-bottom:10px;}
  h1{font-family:'Bebas Neue',sans-serif;font-size:3rem;letter-spacing:.04em;margin-bottom:36px;line-height:1;}
  .error-box{background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.2);border-radius:3px;padding:14px 16px;font-size:.83rem;color:var(--red);margin-bottom:20px;}
  .field{margin-bottom:20px;}
  .field label{display:block;font-size:.68rem;letter-spacing:.16em;text-transform:uppercase;font-weight:700;color:var(--muted);margin-bottom:9px;}
  .field input,.field textarea{width:100%;background:var(--input-bg);border:1px solid var(--border);color:var(--text);padding:13px 16px;font-family:'DM Sans',sans-serif;font-size:.92rem;border-radius:3px;outline:none;transition:all .25s;}
  .field input::placeholder,.field textarea::placeholder{color:var(--muted);}
  .field input:focus,.field textarea:focus{border-color:var(--orange);box-shadow:0 0 0 3px rgba(255,107,0,.1);background:#1d1d1d;}
  .field textarea{resize:vertical;min-height:100px;line-height:1.6;}
  .field-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
  .field-note{font-size:.72rem;color:var(--muted);margin-top:6px;}

  /* Upload area */
  .upload-area{border:2px dashed var(--border);border-radius:4px;padding:32px;text-align:center;cursor:pointer;transition:all .25s;background:var(--input-bg);position:relative;}
  .upload-area:hover,.upload-area.dragover{border-color:var(--orange);background:#1c1309;}
  .upload-area input{display:none;}
  .upload-icon{margin:0 auto 14px;opacity:.35;}
  .upload-title{font-size:.9rem;color:var(--text);font-weight:500;margin-bottom:5px;}
  .upload-sub{font-size:.75rem;color:var(--muted);}
  .upload-hint{font-size:.68rem;color:#444;margin-top:6px;letter-spacing:.06em;}

  /* Preview grid */
  .preview-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:10px;margin-top:16px;}
  .preview-item{position:relative;aspect-ratio:1;border-radius:4px;overflow:hidden;border:1px solid var(--border);animation:previewIn .3s cubic-bezier(.16,1,.3,1);}
  @keyframes previewIn{from{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}
  .preview-item img{width:100%;height:100%;object-fit:cover;display:block;}
  .preview-item .primary-badge{position:absolute;top:5px;left:5px;background:var(--orange);color:#000;font-size:.55rem;letter-spacing:.12em;text-transform:uppercase;font-weight:700;padding:3px 7px;border-radius:2px;}
  .preview-item .remove-btn{position:absolute;top:5px;right:5px;width:22px;height:22px;border-radius:50%;background:rgba(0,0,0,.7);border:none;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .2s;}
  .preview-item .remove-btn:hover{background:var(--red);}
  .preview-count{font-size:.75rem;color:var(--orange);margin-top:10px;font-weight:500;text-align:center;}

  .submit-btn{width:100%;background:var(--orange);color:#000;border:none;padding:16px;font-family:'DM Sans',sans-serif;font-size:.83rem;font-weight:700;letter-spacing:.16em;text-transform:uppercase;border-radius:3px;cursor:pointer;margin-top:8px;transition:all .3s;box-shadow:0 0 36px rgba(255,107,0,.28);display:flex;align-items:center;justify-content:center;gap:10px;}
  .submit-btn:hover{background:#ff7d1a;transform:translateY(-2px);box-shadow:0 4px 50px rgba(255,107,0,.45);}
</style>
</head>
<body>
<div class="bg"></div>
<div class="card">
  <a class="back-link" href="/dashboard">
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M13 8H3M3 8L7 4M3 8L7 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
    Back to Dashboard
  </a>
  <p class="eyebrow">Catalog Management</p>
  <h1>Add New<br>Design</h1>

  {% if error %}
  <div class="error-box">⚠ {{ error }}</div>
  {% endif %}

  <form method="POST" enctype="multipart/form-data" id="addForm">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <div class="field-row">
      <div class="field">
        <label>Design Code</label>
        <input name="code" placeholder="e.g. DES-001" required>
      </div>
      <div class="field">
        <label>Price (₹)</label>
        <input name="price" type="number" placeholder="e.g. 499" required>
      </div>
    </div>

    <div class="field-row">
      <div class="field">
        <label>Design Name</label>
        <input name="name" placeholder="Enter design name" required>
      </div>
      <div class="field">
        <label>Stock Quantity</label>
        <input name="stock_quantity" type="number" min="0" value="10" required>
        <p class="field-note">0 = Out of Stock.</p>
      </div>
    </div>

    <div class="field">
      <label>Description</label>
      <textarea name="description" placeholder="Describe this design..."></textarea>
    </div>

    <div class="field">
      <label>
        Design Photos
        <span style="color:var(--muted);font-size:.62rem;text-transform:none;letter-spacing:0;font-weight:400"> — upload multiple, first one is the main photo</span>
      </label>

      <label class="upload-area" for="designImgs" id="dropZone">
        <input type="file" id="designImgs" name="images" accept="image/png,image/jpeg,image/jpg,image/gif,image/webp" multiple onchange="handleFiles(this.files)">
        <svg class="upload-icon" width="44" height="44" viewBox="0 0 44 44" fill="none"><rect x="4" y="10" width="36" height="28" rx="3" stroke="currentColor" stroke-width="1.5"/><path d="M22 34V20M22 20L15 27M22 20L29 27" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><circle cx="15" cy="17" r="3" stroke="currentColor" stroke-width="1.5"/></svg>
        <p class="upload-title">Click to select photos</p>
        <p class="upload-sub">or drag and drop here</p>
        <p class="upload-hint">PNG · JPG · JPEG · GIF · WEBP · Max 5MB each</p>
      </label>

      <div class="preview-grid" id="previewGrid"></div>
      <p class="preview-count" id="previewCount" style="display:none"></p>
    </div>

    <button class="submit-btn" type="submit">
      Add to Catalog
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M3 8H13M13 8L9 4M13 8L9 12" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
  </form>
</div>

<script>
let fileList = []; // track selected files

function handleFiles(files) {
  for (let f of files) {
    if (fileList.length >= 10) break; // max 10 photos
    if (!f.type.startsWith('image/')) continue;
    // Avoid duplicates by name+size
    if (!fileList.find(x => x.name === f.name && x.size === f.size))
      fileList.push(f);
  }
  renderPreviews();
  syncInput();
}

function removeFile(index) {
  fileList.splice(index, 1);
  renderPreviews();
  syncInput();
}

function renderPreviews() {
  const grid  = document.getElementById('previewGrid');
  const count = document.getElementById('previewCount');
  grid.innerHTML = '';

  fileList.forEach((file, i) => {
    const url  = URL.createObjectURL(file);
    const item = document.createElement('div');
    item.className = 'preview-item';
    item.innerHTML = `
      <img src="${url}" alt="preview">
      ${i === 0 ? '<span class="primary-badge">Main</span>' : ''}
      <button type="button" class="remove-btn" onclick="removeFile(${i})" title="Remove">
        <svg width="10" height="10" viewBox="0 0 10 10" fill="none"><path d="M1.5 1.5l7 7M8.5 1.5l-7 7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
      </button>`;
    grid.appendChild(item);
  });

  if (fileList.length > 0) {
    count.style.display = 'block';
    count.textContent   = `${fileList.length} photo${fileList.length > 1 ? 's' : ''} selected — first is the main image`;
  } else {
    count.style.display = 'none';
  }
}

function syncInput() {
  // Rebuild a DataTransfer to keep the file input in sync with fileList
  const dt    = new DataTransfer();
  const input = document.getElementById('designImgs');
  fileList.forEach(f => dt.items.add(f));
  input.files = dt.files;
}

// Drag and drop
const dropZone = document.getElementById('dropZone');
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', e => {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  handleFiles(e.dataTransfer.files);
});
</script>
</body>
</html>
